#!/bin/sh

exit_0()
{
  echo "Exiting..."
  exit 0
}

check_if_su()
{
  if [ "$(id -u)" != 0 ]; then
    echo "Please run with su privileges"
    exit_0
  fi
}

validate_file()
{
  FILE=$1
  if [ -e "$FILE" ]; then
    echo "File is valid" 
  else
    echo "Not a valid file"
    exit_0
  fi
}

run_dd()
{
  case "$(uname -s)" in
    Linux | FreeBSD | DragonFly)
      dd if="$if" of="$of" bs="$bs" conv=noerror,sync status=progress;;
    *)
      dd if="$if" of="$of" bs="$bs" conv=noerror,sync;;
  esac
}

echo "Welcome to dd-safe"
echo "------------------"
check_if_su
printf 'Enter data source: '
read -r if
validate_file "$if"
printf 'Enter data destination: '
read -r of
validate_file "$of"
printf 'What block size do you want to use? (default: 64k, 128k, 1M): '
read -r bs

case $bs in
  "" | " ")
    bs="64k"
    echo "No value provided. Setting default value: $bs";;
  *)
    bs=$bs;;
esac

echo "Preparing to copy from source: $if to destination: $of with block size: $bs"
printf 'Do you want to continue? (y/n) '
read -r confirm

case $confirm in
  "y" | "Y")
    echo "Beginning process..."
    run_dd;;
  *)
  exit_0;;
esac